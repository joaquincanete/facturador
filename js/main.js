// Generated by CoffeeScript 1.8.0
(function() {
  (function($) {
    var actualizaTotales, addArticulo, clearForm, deleteRow, getArticulo, getCliente, getClientes, setCantidad;
    numeral.language('es', {
      delimiters: {
        thousands: '.',
        decimal: ','
      },
      currency: {
        symbol: '$'
      }
    });
    numeral.language('es');
    $("#cod-cliente").on("blur", function() {
      return getCliente($(this));
    });
    '$( window ).on( "beforeunload", () ->\n	return "Todos los datos actuales se perderan si contin√∫a." \n)';
    $("#search-clientes").on("click", function() {
      return getClientes();
    });
    $("body").on("click", ".list-cli-row", function() {
      $("#cod-cliente").val($(this).data("cid"));
      $("#modal-clientes").modal('hide');
      return $("#cod-cliente").blur();
    });
    $("body").on("click", ".delete-row", function() {
      return deleteRow($(this));
    });
    $("#articulo-codigo").on("blur", function() {
      return getArticulo($(this));
    });
    $("#articulo-cantidad").on("keyup", function(e) {
      return setCantidad($(this), e);
    });
    $("#articulo-cantidad").on("keydown", function(e) {
      return addArticulo(e);
    });
    $("#clear-form").on("click", function() {
      return clearForm();
    });
    getCliente = function(elm) {
      var data, val;
      val = elm.val();
      data = {
        'accion': "obtener-cliente",
        'data': {}
      };
      data.data['cliente-id'] = val;
      if (val !== '') {
        $.ajax({
          beforeSend: function(xhr, settings) {
            return null;
          },
          complete: function(xhr, status) {
            return null;
          },
          data: '&json=' + JSON.stringify(data),
          success: function(data, status, xhr) {
            var obj;
            obj = $.parseJSON(data);
            if (obj.estado === "exito") {
              return $("#datos-cliente").html("" + obj.data.nombre + "<br><small>" + obj.data.direccion + "</small>");
            }
          },
          type: 'POST',
          url: "ajax.php"
        });
        return null;
      }
    };
    getClientes = function() {
      var data;
      data = {
        'accion': "obtener-clientes",
        'data': {}
      };
      $.ajax({
        beforeSend: function(xhr, settings) {
          return null;
        },
        complete: function(xhr, status) {
          return null;
        },
        data: '&json=' + JSON.stringify(data),
        success: function(data, status, xhr) {
          var obj;
          obj = $.parseJSON(data);
          $.each(obj.data, function(key, value) {
            return $("#modal-clientes .modal-body tbody").append("<tr class='list-cli-row' data-cid='" + key + "'><td>" + key + "</td><td>" + value.nombre + "</td><td>" + value.direccion + "</td></tr>");
          });
          return $("#modal-clientes").modal('show');
        },
        type: 'POST',
        url: "ajax.php"
      });
      return null;
    };
    getArticulo = function(elm) {
      var data, val;
      val = elm.val();
      data = {
        'accion': "obtener-articulo",
        'data': {}
      };
      data.data['articulo-id'] = val;
      if (val !== '') {
        $.ajax({
          beforeSend: function(xhr, settings) {
            return null;
          },
          complete: function(xhr, status) {
            return null;
          },
          data: '&json=' + JSON.stringify(data),
          success: function(data, status, xhr) {
            var obj, precio, precioFormat;
            obj = $.parseJSON(data);
            precio = obj.data.precio;
            precioFormat = numeral(precio).format("$ 0,0.00");
            if (obj.estado === "exito") {
              $("#articulo-denominacion").html("" + obj.data.denominacion);
              $("#articulo-precio").html("" + precio);
              $("#articulo-precio").data("precio", "" + precio);
              return $("#articulo-importe").html("" + precioFormat);
            }
          },
          type: 'POST',
          url: "ajax.php"
        });
        return null;
      }
    };
    setCantidad = function(cantidad, evt) {
      var cant, importe, importeFormat, precio;
      if ($("#articulo-codigo").val() !== "") {
        cantidad = cantidad.val();
        if (cantidad === "") {
          cantidad = "1";
        }
        cant = parseFloat(cantidad);
        precio = parseFloat($("#articulo-precio").data("precio"));
        importe = cant * precio;
        importeFormat = numeral(importe).format("$ 0,0.00");
        $("#articulo-importe").data("value", "" + importe);
        $("#articulo-importe").html("" + importeFormat);
      }
      return null;
    };
    addArticulo = function(evt) {
      if (evt.keyCode === 9 || evt.keyCode === 13) {
        if ($("#articulo-codigo").val() !== "") {
          if ($("#articulo-cantidad").val() === "") {
            $("#articulo-cantidad").val("1");
          }
          $(".articulos tbody").append("<tr> <td>" + ($("#articulo-codigo").val()) + "</td> <td class='text-center'>" + ($("#articulo-cantidad").val()) + "</td> <td>" + ($("#articulo-denominacion").html()) + "</td> <td class='text-right'>" + ($("#articulo-precio").html()) + "</td> <td class='text-right importe' data-value='" + ($("#articulo-importe").data("value")) + "'>" + ($("#articulo-importe").html()) + "</td> <td class='text-right'><a class='btn btn-danger delete-row' href='#'><i class='fa fa-trash'></i></a></td> </tr>");
          evt.preventDefault();
          actualizaTotales();
          return clearForm();
        }
      }
    };
    clearForm = function() {
      $("#articulo-codigo").val("");
      $("#articulo-cantidad").val("");
      $("#articulo-denominacion").html("");
      $("#articulo-precio").html("$ 0.00");
      $("#articulo-importe").html("$ 0.00");
      return $("#articulo-codigo").focus();
    };
    deleteRow = function(elm) {
      elm.parents("tr").remove();
      return clearForm();
    };
    return actualizaTotales = function() {
      var total, totalFormat;
      total = 0;
      $(".articulos tbody tr").each(function(i) {
        return total += parseFloat($(this).find("td.importe").data("value"));
      });
      totalFormat = numeral(total).format("$ 0,0.00");
      $("#total").html(totalFormat);
      return $("#contar").html($(".articulos tbody tr").length);
    };
  })(jQuery);

}).call(this);
